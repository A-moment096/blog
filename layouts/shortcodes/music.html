{{- $scratch := .Page.Scratch.Get "scratch" -}}
<!-- require APlayer -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<style type="text/css">
[data-scheme="dark"] .aplayer {
    background: var(--card-background);
    border: 1px solid var(--card-separator-color);
}

[data-scheme="dark"] .aplayer.aplayer-withlist .aplayer-info {
    border-bottom-color: var(--card-separator-color);
}

[data-scheme="dark"] .aplayer.aplayer-fixed .aplayer-list {
    border-color: var(--card-separator-color);
}

[data-scheme="dark"] .aplayer .aplayer-body {
    background-color: var(--card-background);
}

[data-scheme="dark"] .aplayer .aplayer-info {
    border-top-color: var(--card-background);
}

[data-scheme="dark"] .aplayer .aplayer-info .aplayer-music .aplayer-title {
    color: var(--card-text-color-main);
}

[data-scheme="dark"] .aplayer .aplayer-info .aplayer-music .aplayer-author {
    color: var(--card-text-color-secondary);
}

[data-scheme="dark"] .aplayer .aplayer-info .aplayer-controller .aplayer-time {
    color: var(--card-text-color-tertiary);
}

[data-scheme="dark"] .aplayer .aplayer-info .aplayer-controller .aplayer-time .aplayer-icon path {
    fill: var(--card-text-color-tertiary);
}

[data-scheme="dark"] .aplayer .aplayer-list {
    background-color: var(--card-background);
}

[data-scheme="dark"] .aplayer .aplayer-list::-webkit-scrollbar-thumb {
    background-color: var(--card-separator-color);
}

[data-scheme="dark"] .aplayer .aplayer-list::-webkit-scrollbar-thumb:hover {
    background-color: var(--accent-color);
}

[data-scheme="dark"] .aplayer .aplayer-list li {
    color: var(--card-text-color-main);
    border-top-color: var(--card-separator-color);
}

[data-scheme="dark"] .aplayer .aplayer-list li:hover {
    background: var(--card-background-selected);
}

[data-scheme="dark"] .aplayer .aplayer-list li.aplayer-list-light {
    background: var(--card-background-selected);
}

[data-scheme="dark"] .aplayer .aplayer-list li .aplayer-list-index {
    color: var(--card-text-color-secondary);
}

[data-scheme="dark"] .aplayer .aplayer-list li .aplayer-list-author {
    color: var(--card-text-color-secondary);
}

[data-scheme="dark"] .aplayer .aplayer-lrc {
    text-shadow: -1px -1px 0 var(--body-background);
}

[data-scheme="dark"] .aplayer .aplayer-lrc:before {
    background: linear-gradient(to bottom, var(--card-background) 0%, rgba(0,0,0,0) 100%);
}

[data-scheme="dark"] .aplayer .aplayer-lrc:after {
    background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, var(--card-background) 100%);
}

[data-scheme="dark"] .aplayer .aplayer-lrc p {
    color: var(--card-text-color-main);
}

[data-scheme="dark"] .aplayer .aplayer-miniswitcher {
    background: var(--card-background-selected);
}

[data-scheme="dark"] .aplayer .aplayer-miniswitcher .aplayer-icon path {
    fill: var(--card-text-color-tertiary);
}

/* 浅色模式下的音乐播放器优化 */
[data-scheme="light"] .aplayer {
    background: var(--card-background);
    border: 1px solid var(--card-separator-color);
}

[data-scheme="light"] .aplayer .aplayer-info .aplayer-music .aplayer-title {
    color: var(--card-text-color-main);
}

[data-scheme="light"] .aplayer .aplayer-info .aplayer-music .aplayer-author {
    color: var(--card-text-color-secondary);
}

[data-scheme="light"] .aplayer .aplayer-list li:hover {
    background: var(--card-background-selected);
}
</style>
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<!-- <script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script> -->
<script src="/js/Meting.min.js"></script>

{{- if .IsNamedParams -}}
    {{- if .Get "url" -}}
        <meting-js url="{{ .Get `url` }}" name="{{ .Get `name` }}" artist="{{ .Get `artist` }}" cover="{{ .Get `cover` }}" theme="{{ .Get `theme` | default `#2980b9` }}"
        {{- with .Get "fixed" }} fixed="{{ . }}"{{ end -}}
        {{- with .Get "mini" }} mini="{{ . }}"{{ end -}}
        {{- with .Get "autoplay" }} autoplay="{{ . }}"{{ end -}}
        {{- with .Get "volume" }} volume="{{ . }}"{{ end -}}
        {{- with .Get "mutex" }} mutex="{{ . }}"{{ end -}}
        ></meting-js>
    {{- else if .Get "auto" -}}
        <meting-js auto="{{ .Get `auto` }}" theme="{{ .Get `theme` | default `#2980b9` }}"
        {{- with .Get "fixed" }} fixed="{{ . }}"{{ end -}}
        {{- with .Get "mini" }} mini="{{ . }}"{{ end -}}
        {{- with .Get "autoplay" }} autoplay="{{ . }}"{{ end -}}
        {{- with .Get "loop" }} loop="{{ . }}"{{ end -}}
        {{- with .Get "order" }} order="{{ . }}"{{ end -}}
        {{- with .Get "volume" }} volume="{{ . }}"{{ end -}}
        {{- with .Get "mutex" }} mutex="{{ . }}"{{ end -}}
        {{- with .Get "list-folded" }} list-folded="{{ . }}"{{ end -}}
        {{- with .Get "list-max-height" }} list-max-height="{{ . }}"{{ end -}}
        ></meting-js>
    {{- else -}}
        <meting-js server="{{ .Get `server` }}" type="{{ .Get `type` }}" id="{{ .Get `id` }}" theme="{{ .Get `theme` | default `#2980b9` }}"
        {{- with .Get "fixed" }} fixed="{{ . }}"{{ end -}}
        {{- with .Get "mini" }} mini="{{ . }}"{{ end -}}
        {{- with .Get "autoplay" }} autoplay="{{ . }}"{{ end -}}
        {{- with .Get "loop" }} loop="{{ . }}"{{ end -}}
        {{- with .Get "order" }} order="{{ . }}"{{ end -}}
        {{- with .Get "volume" }} volume="{{ . }}"{{ end -}}
        {{- with .Get "mutex" }} mutex="{{ . }}"{{ end -}}
        {{- with .Get "list-folded" }} list-folded="{{ . }}"{{ end -}}
        {{- with .Get "list-max-height" }} list-max-height="{{ . }}"{{ end -}}
        ></meting-js>
    {{- end -}}
{{- else if strings.HasSuffix (.Get 0) "http" -}}
    <meting-js auto="{{ .Get 0 }}" theme="#2980b9"></meting-js>
{{- else -}}
    <meting-js server="{{ .Get 0 }}" type="{{ .Get 1 }}" id="{{ .Get 2 }}" theme="#2980b9"></meting-js>
{{- end -}}
{{- $scratch.Set "music" true -}}