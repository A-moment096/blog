/// Params:
///     Resources: Where to search for images
///     Image: Image URL

/// Returns:
///     Local: true if the image is local, false if it is remote
///     Resource: Hugo image resource object, not nil if the image is local
///     Permalink: Image URL
///     Height: Image height
///     Width: Image width

{{ $result := "" }}

{{ if .Image }}
    {{- $imageSrc := .Image -}}
    {{- if reflect.IsMap .Image }}
        {{- $imageSrc = .Image.src -}}
    {{- end -}}
    {{ $url := urls.Parse $imageSrc }}
    {{ $resource := "" }}
    {{ if not (in (slice "https" "http") $url.Scheme) }}
        {{ $resource = .Resources.Get (printf "%s" ($imageSrc | safeURL)) }}
    {{ else }}
        {{ with try (resources.GetRemote $url) }}
            {{ with .Err }}
                {{ errorf "%s" . }}
            {{ else with .Value }}
                {{ $resource = . }}
            {{ else }}
                {{ errorf "Unable to get remote resource %q" $url }}
            {{ end }}
        {{ end }}   
    {{ end }}

    {{ if $resource }}
        {{- $isSVG := eq $resource.MediaType.SubType "svg"  -}}
        {{- if $isSVG -}}
            {{ $result = dict
                "Local" true
                "Resource" $resource
                "Permalink" $resource.RelPermalink
                "Height" nil
                "Width" nil
            }}
        {{- else -}}            
            {{- $result = dict
                "Local" true
                "Resource" $resource
                "Permalink" $resource.RelPermalink
                "Height" $resource.Height
                "Width" $resource.Width
            }}
        {{- end -}}
    {{ else }}
        {{- $result = dict
            "Local" false
            "Resource" nil
            "Permalink" $imageSrc
            "Height" nil
            "Width" nil
        }}
    {{ end }}
{{ end }}

{{ return $result }}