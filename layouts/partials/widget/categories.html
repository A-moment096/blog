{{- $context := .Context -}}
{{- $limit := default 10 .Params.limit -}}
<section class="widget tagCloud categories">
    <div class="widget-icon">
        {{ partial "helper/icon" "categories" }}
    </div>
    <h2 class="widget-title section-title">{{ T "widget.categoriesCloud.title" }}</h2>

    <div class="tagCloud-tags scrollable-tags">
        {{- $categories := $context.Site.Taxonomies.categories.ByCount -}}
        {{- $maxCount := 0 -}}
        {{- $minCount := 999999 -}}
        
        {{/* 计算最大和最小分类数量 */}}
        {{- range first $limit $categories -}}
            {{- if gt .Count $maxCount -}}
                {{- $maxCount = .Count -}}
            {{- end -}}
            {{- if lt .Count $minCount -}}
                {{- $minCount = .Count -}}
            {{- end -}}
        {{- end -}}
        
        {{/* 渲染分类，按频率分配颜色等级 */}}
        {{ range first $limit $categories }}
            {{- $percentage := 0 -}}
            {{- if gt $maxCount $minCount -}}
                {{- $percentage = div (mul (sub .Count $minCount) 100) (sub $maxCount $minCount) -}}
            {{- else -}}
                {{- $percentage = 100 -}}
            {{- end -}}
            
            {{- $colorClass := "" -}}
            {{- if le $percentage 20 -}}
                {{- $colorClass = "category-frequency-1" -}}
            {{- else if le $percentage 40 -}}
                {{- $colorClass = "category-frequency-2" -}}
            {{- else if le $percentage 60 -}}
                {{- $colorClass = "category-frequency-3" -}}
            {{- else if le $percentage 80 -}}
                {{- $colorClass = "category-frequency-4" -}}
            {{- else -}}
                {{- $colorClass = "category-frequency-5" -}}
            {{- end -}}
            
            <a href="{{ .Page.RelPermalink }}" 
               class="tag-item {{ $colorClass }}" 
               title="{{ .Page.Title }} ({{ .Count }} {{ if eq .Count 1 }}篇文章{{ else }}篇文章{{ end }})">
                {{ .Page.Title }}
                <span class="tag-count">{{ .Count }}</span>
            </a>
        {{ end }}
    </div>
</section>
