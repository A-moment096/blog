# 右侧栏自适应高度功能说明

## 功能概述

为博客的右侧栏添加了自适应窗口高度的功能，解决右侧栏内容过长导致页面滚动问题。

## 主要特性

### 🔧 自适应高度
- **动态计算**：右侧栏高度自动适配当前窗口高度
- **公式**：`max-height = 100vh - 顶部边距 × 2`
- **滚动支持**：超出部分自动显示滚动条

### 📱 响应式设计
- **桌面端**（≥1024px）：启用粘性定位和高度限制
- **平板/手机端**（<1024px）：恢复默认布局，无高度限制
- **低高度屏幕**（<500px）：自动禁用粘性定位

### 🎯 智能小部件限制
根据不同小部件类型设置合适的高度限制：

#### 搜索小部件
- 固定在顶部，不参与滚动
- 增加底部边框分隔线

#### 标签云/分类云
- 基础限制：300px 或 30vh（取较小值）
- 中等屏幕：200px（高度 ≤800px）
- 小屏幕：150px（高度 ≤600px）

#### 目录（TOC）
- 基础限制：400px 或 40vh（取较小值）
- 中等屏幕：300px（高度 ≤800px）
- 小屏幕：200px（高度 ≤600px）

#### 归档小部件
- 基础限制：250px 或 25vh（取较小值）
- 中等屏幕：200px（高度 ≤800px）

## 实现细节

### 文件结构
```
assets/
└── scss/
    └── modules/
        └── _sidebar.scss      # 右侧栏样式增强
```

### 核心样式
```scss
.right-sidebar {
  &.sticky {
    position: sticky;
    top: var(--main-top-padding);
    max-height: calc(100vh - var(--main-top-padding) * 2);
    overflow-y: auto;
  }
}
```

### 滚动条样式
- 使用浏览器默认滚动条
- 平滑滚动效果
- 触摸设备优化

## 使用效果

### ✅ 解决的问题
1. **长页面滚动**：右侧栏不再无限延长
2. **内容可见性**：所有小部件都能通过滚动访问
3. **屏幕适配**：在不同高度的屏幕上都有良好体验

### 🎨 用户体验
1. **搜索置顶**：搜索功能始终可见，便于快速访问
2. **分层滚动**：页面主体和右侧栏可独立滚动
3. **智能回退**：在不适合的屏幕尺寸下自动禁用

## 兼容性

### 浏览器支持
- ✅ 现代浏览器（Chrome, Firefox, Safari, Edge）
- ✅ 移动端浏览器
- ✅ 支持 CSS Grid 和 Flexbox 的浏览器

### 主题兼容
- ✅ 完全兼容 Hugo Stack 主题
- ✅ 不影响原有布局逻辑
- ✅ 向后兼容，可随时移除

## 自定义选项

### 调整高度限制
在 `_sidebar.scss` 中修改：
```scss
max-height: calc(100vh - var(--main-top-padding) * 2);
```

### 调整小部件高度
```scss
.widget.tagCloud .tagCloud-tags.scrollable-tags {
  max-height: min(300px, calc(30vh));  // 修改这里
}
```

### 禁用特定小部件的高度限制
```scss
.widget.your-widget {
  .widget-content {
    max-height: none !important;
    overflow: visible !important;
  }
}
```

## 性能考虑

- **最小化重排**：使用 `position: sticky` 而非 JavaScript
- **GPU 加速**：滚动动画使用硬件加速
- **内存优化**：只在必要时应用样式

## 故障排除

### 如果右侧栏不显示滚动条
1. 检查浏览器窗口高度是否足够小
2. 确认是否在桌面端（≥1024px）
3. 验证小部件内容是否超出限制高度

### 如果布局显示异常
1. 检查 CSS 导入顺序
2. 确认没有其他样式冲突
3. 验证主题版本兼容性
