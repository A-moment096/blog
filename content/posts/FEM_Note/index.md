---
title: "有限元方法笔记"
description: 学习一下有限元求解法
date: 2025-03-11
categories:
- Mathematics
- Programming
tags:
- Numerical Analysis
- Finite Element Method
- Python
- Note
image: 
math: true
comments: true
draft: true
---

*一些关于有限元求解法的学习笔记，希望是能涉及一些理论方法，并且用一些简单代码做实践*

## 动机

$$
\gdef\d{\space\mathrm{d}}
\gdef\p{\partial}
\gdef\Del{\nabla}
\gdef\R{\mathbb{R}}
\gdef\pfrac#1#2{\dfrac{\p #1}{\p #2}}
\gdef\ddfrac#1#2{\dfrac{\mathrm{d} #1}{\mathrm{d} #2}}
$$

### 为啥突然想做这个？

在遥远的本科时代，我还是一个懵懂无知的傻孩子。当时有一门课应该叫 *Computational Method*，说白了就是 Python 课，不过课上还包含了很多各种各样的计算方法与模拟方法。当时有一节的内容是教做有限元模拟，算的是一个一维的简单案例，不过由于那会儿对数学一窍不通，只能说是跟着稀里糊涂瞎做了作业，就草草交差了事了。现在回想起来，也许我应该多看看这个部分，毕竟有限元作为一个微分方程数值求解方法，现在能称为非常主流的一种模拟方法代名词，一定有它的独到之处；而且，作为我接触材料计算模拟的第一步，我最早做的和材料计算相关的东西就是跟着我的小组一起做了有限元的模拟（当然，用的是 Abaqus 就是了）。我和有限元的缘分应该不止于此，所以，为什么不学一下呢？

### 大纲

目前打算先从理论开始吧，有限元方法是需要进行一部分的数学推导和解释的，特别是和它相关的数学概念还蛮多的。介绍完这些之后，也许可以尝试一下使用 Python 来算几个小例子，比如一维下的某个简单的微分方程，或者是某个二维下的简单微分方程？也许还可以尝试一下 FEM 最强大的地方，就是加上比较复杂的边界条件之后，尝试解力学方程。

不再啰嗦了，我们就直接开始吧。

## FEM 简介

有限元方法，英文是 Finite Element Method，一般简称 FEM，一开始是一种数值解微分方程的方法。它区别于有限差分法 FDM 这种微观方法与傅立叶谱 Fourier Spectrum 这种全局方法，是通过对求解区域进行划分，从划分好的每个块内得到的解进行叠加从而得到整体求解区域上的是一种局域方法。这种模拟方法对复杂的模拟域会比较友好，且对复杂的边界条件也很方便。不过有限元也有它的缺点，就现在来看，我个人认为是网格划分算法太过复杂，而优秀的网格是有限元法能得到优秀结果的必要保证。然而，由于网格划分算法的发展，有限元这个数值方法本身甚至已经发展为一种模拟方法。

我们先来看看 FEM 的一些数学基础，即：有限元方法是怎么解微分方程的。

## FEM 的数学基础

本节内容主要参考自 S. Bulent Biner 所著的 *Programming Phase-Field Modeling* 的第六章前两节，以及曾经的课程资料。

### 微分方程的记号

我们先来做一些和微分方程相关的铺垫，特别是记号方面。对它们的理解将会方便我们后续的介绍。

#### 算符记号

既然 FEM 是一种解微分方程的方法，我们不妨先看一下，我们要解的微分方程是什么样子的。虽然我使用 FEM 的目的就是解一些力学场或者相场，用到的自然是那几套模型，然而先考察一般的微分方程也挺好的。那么，我们就设我们要解的未知函数 $u$ 满足微分方程 $Lu = f,x\in\Omega$，它所需要满足的边界条件则记为 $Bu = 0,x\in\p\Omega$。

你也许好奇：啊？这是微分方程吗？这个边界条件怎么写成了这个样子？$\p\Omega$ 又是什么东西？那就让我们先从方程本身开始，来看几个也许更熟悉的，带有导数记号的传统微分方程。比如：

$$
\ddfrac{u}{x} = 0;\space\ddfrac{^2u}{x^2}+u = x^2;\space\pfrac{^2u}{x^2}+\pfrac{^2u}{y^2} = 0，
$$

等等。我们可以看到：这里的未知函数 $u$ 在微分方程中都被做了不同程度的求导：或者是一阶导，或者是二阶导，甚至可以是偏导。它们当然还可以是更高阶的导数，不过，它们也可以是更低阶的导数，比如：零阶导（不求导，即直接出现 $u$），或者只是给它乘上一些常数。我们回忆导数的一个重要性质：线性（Linearity），即乘数与求导可交换，加法和求导可交换。有了线性这一重要性质，我们就可以借用一些线性代数中的结论，将这些对 $u$ 求导后相加的操作抽象为一个算符作用于 $u$ 上。我们就叫这个算符为 $L$ 好了。

再看等号右侧，它们或者是一些常数，或者就是和 $u$ 没有关系的，只与自变量相关的一些简单函数，因此我们把它们捏起来，统称为 $f$。最后，方程后面的 $x$ 就代表了求解域中的元素，它不一定是一个数，也有可能是一个向量，具体形式则取决于描述它的集合 $\Omega$ 是什么样的。

那么，按照同样的思路，你也许已经明白了 $x\in\p\Omega$ 是什么意思了。既然是边界条件，这里的 $\p$ 自然就代表了取边界的意义。这个符号是借自微分几何用来表达边界的算符。作为对边界条件很敏感的学科，借用这样的记号也十分方便。

至此，你应该已经明白了上面的微分方程和边界条件的记号是什么样的了。$L$ 和 $B$ 都是线性算符，它们作用在未知函数 $u$ 上就相当于对函数 $u$ 进行了求导等运算。这样的记号能方便我们讨论和微分方程强相关，而与其具体形式没什么太大关系的问题，比如：强形式与弱形式。

#### \$\nabla\$

我们先来介绍这个神奇的符号，$\Del$（Nabla，也可以叫 Del）。这个符号在[这篇文章]({{< ref "pf_tutorial_1/#向量微积分-nabla" >}})中也有介绍，感兴趣可以去看看。它在向量微积分中非常常见，其是一个算符，在三维情况下是这样定义的：

$$
\begin{bmatrix}
\pfrac{}{x},\pfrac{}{y},\pfrac{}{z}
\end{bmatrix}^{\intercal}
$$

我们有很多种使用该算符的方式。首先，鉴于它是一个算符，自然它可以直接作用到一个合适的函数上。对于我们取一个三元函数 $f\vcentcolon\R^3\to\R$，则 $\Del f$ 的结果就是向量

$$ \begin{bmatrix}
\pfrac{f}{x},\pfrac{f}{y},\pfrac{f}{z}
\end{bmatrix}^{\intercal}, $$

也就是把 $f$ 放到这个向量的每一个分量上再进行计算，而这就是所谓的梯度。另外，由于它还是一个向量，我们就可以像在我们熟悉的三维空间里一样，用它进行点积和叉乘。不过要注意的是，由于 $\Del$ 本身是一个算符，和它进行点积和叉乘的对象也需要是算符能作用的对象，即一个函数。这样一来，这里的函数就需要是一个向量值函数，即 $\mathbf{f}\vcentcolon\R^3\to\R^3$。我们看一下具体形式：

$$
\begin{align*}
\Del \cdot \mathbf{f} = \pfrac{f_1}{x}+\pfrac{f_2}{y}+\pfrac{f_3}{z} ;\\
\Del \times \mathbf{f} = 
\begin{vmatrix}
\mathbf{x}_1                      & \mathbf{x}_2                      & \mathbf{x}_3                      \\
      \frac{\partial }{\partial x_1} & \frac{\partial }{\partial x_2} & \frac{\partial }{\partial x_3} \\
      f_1                            & f_2                            & f_3
\end{vmatrix},
\end  {align*}
$$
这里 $f_1,f_2,f_3$ 是 $\mathbf{f}$ 的三个分量。第一个就是所谓的散度，而第二个则是旋度。

我们指出，这个符号的作用很像函数对自变量求导，只不过是针对多维线性空间下的求导。另外，有作者为了更加明显地区分它们，选择不使用 $\Del$ 来指代梯度，旋度，散度等，而是直接使用对应的文字形式的算符。下面是一个对照表：

|            |          梯度           |               散度               |               旋度                |
| :--------: | :---------------------: | :------------------------------: | :-------------------------------: |
|    英文    |        Gradient         |            Divergence            |               Curl                |
| $\Del$记号 |        $\Del f$         |     $\Del \cdot \mathbf{f}$      |      $\Del\times \mathbf{f}$      |
|  文字算符  | $\operatorname{grad} f$ | $\operatorname{div}  \mathbf{f}$ | $\operatorname{curl}  \mathbf{f}$ |

#### \$\nabla^2 = \Delta \vcentcolon= \nabla \cdot \nabla\$

我们下来介绍的这个算符和 $\Del$ 有关，且十分常用，它就是所谓的拉普拉斯算符（Laplacian）$\Del^2$。它还有一种记号，即 $\Delta$。这里需要注意的是，在向量微积分中，$\Delta$ 记号还可能被作者用以代表差值。不过在微分方程的语境下，它更多还是代表拉普拉斯算符。一般而言，根据作者的喜好，会在上下文中选择两种记号其中的一个来代指拉普拉斯算符。这里为了避免歧义（其实就是我喜欢），就使用 $\Del^2$ 好了。

然而，即便使用了 $\Del^2$，也不代表它就是单纯的对一个函数作用 $\Del$ 两次。如果你真的尝试这么做的话，会发现在作用第二次时会出现问题。实际上，$\Del^2$ 的定义是先对函数求梯度，再对这个梯度求散度，即

$$\nabla^2 = \nabla \cdot\nabla = \pfrac{^2}{x^2}+\pfrac{^2}{y^2}+\pfrac{^2}{z^2}, $$

最后得到的结果应该是一个标量三元函数。最后，我们提出，对算符做次幂时需要特别关注算符的定义。以平方举例可能平方只是单纯的作用两次，然而也有可能并不能直接作用两次。一个例子是双调和算子 $\Delta^2 = \Del^4 = \Delta\Delta = (\Del\cdot\Del)(\Del\cdot\Del)$。可以看到，$\Del$ 的输入输出在三维下都是一个三元标量值函数，它的平方就可以是单纯的作用两次。

有了上面这些记号，就不会对一些物理背景很强的微分方程感到一头雾水了。应该。

### 微分方程的弱形式

接下来我们就来看看，所谓的 *强形式* 与 *弱形式* 究竟是什么。

#### 强形式

有了微分方程和边界条件，我们自然希望能解开这个微分方程，得到对应的解函数 ${u}$。由于这个解能够完全满足所有的条件，这个解常有人称之为强形式下的解，或者强解[^1]。然而，这个过程通常是十分困难的，甚至对于某一些（其实是绝大多数的）微分方程问题而言，找到解析解是不可能的。这实在是令人沮丧的消息。然而，这并不是故事的终结。既然我们不能完全满足所有条件，那么，假如我们只部分满足条件，能得到某种 “解” 吗？

#### 弱形式

答案是：可以。我们放宽条件，不要求让解在求解域中的每个点都必须满足要求，那就可以只要求它在其中的绝大多数满足要求，或者让它在每个局部区域都满足要求即可。事实上，我们采用后面的形式，且使用一些技巧来得到这样一个 “解”，而这就是所谓的弱解了。为了求出弱解，我们就会将方程转化为弱形式。

我们来看看应该如何放宽微分方程的这些条件。首先，我们从另一个角度来观察一个微分方程的解：它不只是解微分方程得到的结果，而是切实满足了所有的条件的一个式子。也就是说，将解带入原来的等式中是一定会让等式成立的。那么，我们就从这个等式下手：既然解带入式子能成立，给这个等式两端都乘以任何一个函数后，这个等式照样是成立的；我们再给这个乘了个函数的等式两端积分，也是依旧保持等式成立的。我们得到了这样的一个关系：*如果某个函数满足微分方程* 

$$Lu=f$$

*，那么也就一定满足*

$$\int (Lu)v \d x= \int fv\d x,$$

*其中 $v$ 是满足某个条件的任意的函数。* 诶！是不是突然就有一些奇妙的想法了？比如：那么是不是满足了这个积分，就说明是原微分方程的一个解呢？很可惜，并没有那么简单，但是我们明显是希望有这样的结论的。然而，研究微分方程的数学家们对这件事深有研究，它们给出了许多的定理（真的很多）来保证满足这个积分条件的函数在一定程度上是原解的非常好的近似，且在某些条件下得到的这个弱解就是方程的原解。这里主要是涉及到解的光滑性，如果解足够光滑，那么它就越靠近原解。这里当然不能贴那些定理以及证明了，毕竟我也不会（）但是，核心思路就是这样的：如果一个函数满足了上面的积分，我们就有理由相信这个函数是足够好的。

这里要点明几个要点：这里的函数 $v$ 被称为所谓的测试函数（Test function），它的选取应该在满足基本条件后是应该是随意的。这里任意性保证了我们得到的弱解足够抗造，否则如果这个测试函数不是任意的，而是特意选取的，那么我们得到的弱解可能就只能在某个很特殊的条件下才能成立，从而不是个足够好的原解的近似。然而，实际应用过程中，很难说对这个函数进行广泛的选取，因此对测试函数的选择就决定了具体的有限元求解方法。

#### 弱形式的

### 等参化与等参数单元

所谓有限元，说的就是要对求解域进行划分，划分成有限个单元，然后再进行计算。因此，我们先介绍这样的小单元，也就是所谓的等参单元（Isoparametric Element），是什么样的。即便我们不知道应该如何对模拟域进行划分，我们依旧可以先讨论划分好的单元会怎么参与到有限元的计算中。在有了这些单元之后，如何将原来的求解域映射到这些单元上的过程即为所谓的等参化（Isoparametric）。

在有限元计算中，等参数单元通常以单元的顶点、节点、形状和维数来确定。对于一维模拟域而言，我们几乎只有线段这种单元了，不过我们可以在一个单元内按照需求插入节点。



[^1]:之所以说是 “时常有人称之为”，是因为数学上所谓的强形式，强解，和我们这里打算讨论的东西并不是一个概念。而前者甚至也在微分方程的不同领域中有不同的意义。有定义它为存在一个光滑函数列取逼近的解（[见这里的定义](https://encyclopediaofmath.org/wiki/Strong_solution)）；而还有定义它是二阶弱可导的能满足微分方程条件的解（见 David Gilbarg, Neil S. Trudinger 所著的 *Elliptic Partial Differential Equations of Second Order*）；根据 [SE 上的回答](https://math.stackexchange.com/questions/162353/define-strong-solution)，强解这个概念应该被只用在变分方程中。而在一般的常/偏微分方程教材中是见不到这个所谓的强形式或强解的定义的，出现的就只有经典解，以及弱解。然而，在不那么数学的工程领域，特别是 FEM，我们常称满足所有条件的解，即数学意义下的经典解，就是强解，或者满足强形式的解。因此，使用 “强形式”，“强解” 是不太准确的做法。然而既然大家都干了，我也干吧（）